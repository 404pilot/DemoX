# Maven


## Package
[Maven实战（九）——打包的技巧](http://www.infoq.com/cn/news/2011/06/xxb-maven-9-package)   

1. jar
2. CLI(command line) jar （命令行可以直接运行的 jar 包）
3. war
4. source 包
5. javadoc 包
6. 自定义

格式`<主版本>.<次版本>.<增量版本>-<限定符>`

### Classifier

> Classifier可能是最容易被忽略的Maven特性，但它确实非常重要，我们也需要它来帮助规划坐标。设想这样一个情况，有一个jar项目，就说是 dog-cli-1.0.jar 吧，运行它用户就能在命令行上画一只小狗出来。现在用户的要求是希望你能提供一个zip包，里面不仅包含这个可运行的jar，还得包含源代码和文档，换句话说，这是比较正式的分发包。这个文件名应该是怎样的呢？dog-cli-1.0.zip？不够清楚，仅仅从扩展名很难分辨什么是Maven默认生成的构件，什么是额外配置生成分发包。如果能是dog-cli-1.0-dist.zip就最好了。这里的dist就是classifier，默认Maven只生成一个构件，我们称之为主构件，那当我们希望Maven生成其他附属构件的时候，就能用上classifier。常见的classifier还有如dog-cli-1.0-sources.jar表示源码包，dog-cli-1.0-javadoc.jar表示JavaDoc包等等。制作classifier的方式多种多样，其中最重要的一种是使用Maven Assembly Plugin，感兴趣的读者可以进一步研究。

### Prefix
以前自己是直接导入各种 jar 到工程的 lib 文件夹。因为 jar 中是包含各个依赖的，如果出现二个 jar 使用不同版本的相同 jar，冲突会难以解决。而 maven 打包的 jar 中，**第三方依赖是描述在 pom.xml 中**，并不直接存在 jar 中，剔除会非常容易。如果选择不使用 maven，那就要另外选择办法了。

maven 是一套标准，你不遵循他，也就无法很简单的利用 maven 的产品了。你要使用它，就需要预知 pom.xml 在 jar 包中的存在。

### jar
默认Maven生成的JAR包：

1. 编译生成的.class文件
2. 项目资源文件。（含 pom.xml）

这样的 jar 就是最常用的，直接在 maven 工程中使用坐标导入。`mvn dependency:tree`去解决多个 jar 和工程本身的依赖传递问题。

一般`mvn install`得到

``` plain
$ tree
.
├── META-INF
│   ├── MANIFEST.MF
│   └── maven
│       └── FeedPoller
│           └── feedpoller
│               ├── pom.properties
│               └── pom.xml
└── feedpoller
    ├── FeedPoller$1.class
    ├── FeedPoller$FeedPollerBuilder.class
    ├── FeedPoller.class
    ├── PollingTask.class
    ├── domain
    │   ├── EmptyFeedException.class
    │   ├── EndpointConfig.class
    │   └── PollingResult.class
    └── handler
        ├── DefaultPollingExceptionHandler.class
        ├── NewFeedHandler.class
        └── PollingExceptionHandler.class

7 directories, 13 files
```
分为二部分，class 和 META-INF （maven 导入的 jar 里打开基本都是这个构造）

``` plain
$ cat META-INF/MANIFEST.MF

Manifest-Version: 1.0
Archiver-Version: Plexus Archiver
Built-By: T800
Created-By: Apache Maven 3.3.3
Build-Jdk: 1.8.0_45
```
``` plain
$ cat META-INF/maven/FeedPoller/feedpoller/pom.properties

#Generated by Maven
#Sun Jun 21 18:51:56 CDT 2015
version=1.0-SNAPSHOT
groupId=FeedPoller
artifactId=feedpoller
```

格式是`META-INF/maven/groupId/artifactId/...`

下面还有个 pom.xml，这也解释了`mvn dependency:tree`可以很容易看到各个 jar 之间的依赖

### CLI Jar

1. JAR包中的`/META-INF/MANIFEST.MF`元数据文件必须包含`Main-Class`信息。
2. 项目所有的依赖都必须在Classpath中。

使用`maven-assembly-plugin`可以一起打包需要的dependencies


### Custom Package
参考[maven-assembly-plugin](http://maven.apache.org/plugins/maven-assembly-plugin/)

### 源码包和Javadoc包

> **一个Maven项目只生成一个主构件，当需要生成其他附属构件的时候，就需要用上classifier。**
源码包和Javadoc包就是附属构件的极佳例子。它们有着广泛的用途，尤其是源码包，当你使用一个第三方依赖的时候，有时候会希望在IDE中直接进入该依赖的源码查看其实现的细节，如果该依赖将源码包发布到了Maven仓库，

源码包
``` xml
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-source-plugin</artifactId>
  <version>2.1.2</version>
  <executions>
    <execution>
      <id>attach-sources</id>
      <phase>verify</phase>
      <goals>
        <goal>jar-no-fork</goal>
      </goals>
    </execution>
  </executions>
</plugin>
```

javadoc包
``` xml
<plugin>          
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-javadoc-plugin</artifactId>
  <version>2.7</version>
  <executions>
    <execution>
      <id>attach-javadocs</id>
      <goals>
        <goal>jar</goal>
      </goals>
    </execution>
  </executions>
</plugin>
```

``` plain
$ mvn clean install -DskipTests

[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building FeedPoller 1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
...
[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ feedpoller ---
[INFO] Building jar: /Users/T800/pdev/FeedPoller/target/feedpoller-1.0-SNAPSHOT.jar
[INFO]
[INFO] --- maven-source-plugin:2.4:jar-no-fork (attach-sources) @ feedpoller ---
[INFO] Building jar: /Users/T800/pdev/FeedPoller/target/feedpoller-1.0-SNAPSHOT-sources.jar
[INFO]
[INFO] --- maven-install-plugin:2.4:install (default-install) @ feedpoller ---
[INFO] Installing /Users/T800/pdev/FeedPoller/target/feedpoller-1.0-SNAPSHOT.jar to /Users/T800/.m2/repository/FeedPoller/feedpoller/1.0-SNAPSHOT/feedpoller-1.0-SNAPSHOT.jar
[INFO] Installing /Users/T800/pdev/FeedPoller/pom.xml to /Users/T800/.m2/repository/FeedPoller/feedpoller/1.0-SNAPSHOT/feedpoller-1.0-SNAPSHOT.pom
[INFO] Installing /Users/T800/pdev/FeedPoller/target/feedpoller-1.0-SNAPSHOT-sources.jar to /Users/T800/.m2/repository/FeedPoller/feedpoller/1.0-SNAPSHOT/feedpoller-1.0-SNAPSHOT-sources.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
```

生成了二个 jar

1. feedpoller-1.0-SNAPSHOT.jar
2. feedpoller-1.0-SNAPSHOT-sources.jar

可以预见需要全部 upload，才能在 IDE 中直接 download source。
